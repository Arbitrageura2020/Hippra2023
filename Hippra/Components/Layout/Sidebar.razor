@using Hippra.Models.Enums
@using Hippra.Models.SQL
@using Microsoft.AspNetCore.Http
@using Microsoft.AspNetCore.Identity
@using System.Security.Claims
@inject IJSRuntime JSRuntime;
@inject AuthenticationStateProvider AuthenticationStateProvider
<!-- Sidebar Start -->
<aside id="sidebar" class="sidebar @(IsMinMode?"":"expand")">
    <div class="sidebar-top">
        <div class="sidebar-profile">
            <div class="sidebar-profile-img">
                <a href="/PersonalPage/@UserProfileId">
                    <img src="@ProfileUrl"
                         alt="">
                </a>
            </div>
            <div class="sidebar-profile-info @(IsMinMode?"":"show")" style="@(IsMinMode?"display:none;":"display:block;")">
                <h4>@FullUserName</h4>
                <p>@UserSpeciality</p>
            </div>
        </div>
        <div class="sidebar-menu">
            <ul>
                <li>
                    <a href="dashboardindex" class="active @(IsMinMode?"":"full")">
                        <span class="sidebar-link-icon">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path d="M7 13V18C7 18.5523 6.55228 19 6 19H2C1.44772 19 1 18.5523 1 18V9.03545C1 8.4213 1.28216 7.8412 1.76531 7.46206L8.76606 1.96832C9.49057 1.39977 10.5097 1.39947 11.2345 1.96759L18.2338 7.45349C18.7175 7.8326 19 8.41304 19 9.0276V18C19 18.5523 18.5524 19 18.0001 19H13.9987C13.4464 19 13 18.5523 13 18V13C13 12.4477 12.5523 12 12 12H8C7.44772 12 7 12.4477 7 13Z"
                                      stroke="#039F98" stroke-width="2" stroke-linecap="round" />
                            </svg>
                        </span>
                        <span class="sidebar-link-txt @(IsMinMode?"":"show")">Dashboard</span>
                        <div class="sidebar-link-tooltip" style="@(IsMinMode?"display:flex;":"display:none;")">
                            <span>Dashboard</span>
                        </div>
                    </a>
                </li>
                <li>
                    <a href="notification" class="@(IsMinMode?"":"full")">
                        <span class="sidebar-link-icon notification">
                            <svg width="20" height="22" viewBox="0 0 20 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9.92222 1.96436C6.23004 1.96436 3.22946 4.6383 3.22946 7.92854V10.8013C3.22946 11.4077 2.93944 12.3321 2.59364 12.849L1.31087 14.7476C0.518893 15.9206 1.06547 17.2228 2.51556 17.6601C7.32319 19.0915 12.5101 19.0915 17.3177 17.6601C18.6674 17.2625 19.2586 15.8411 18.5224 14.7476L17.3177 12.849C16.9054 12.1794 16.615 11.4087 16.615 10.8013V8.23368C16.6556 7.92776 16.6315 7.21066 16.2104 6.7896"
                                      stroke="#40454A" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" />
                                <path d="M11.9846 2.25248C11.6388 2.16302 11.2819 2.09343 10.9138 2.05367C9.84294 1.93439 8.81672 2.00397 7.85742 2.25248C8.1809 1.5169 8.98403 1 9.92102 1C10.858 1 11.6611 1.5169 11.9846 2.25248Z"
                                      stroke="#40454A" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round"
                                      stroke-linejoin="round" />
                                <path d="M13.2669 18.0181C13.2669 19.6582 11.7611 21.0002 9.92056 21.0002C9.00588 21.0002 8.15814 20.6622 7.55582 20.1254C6.95347 19.5886 6.57422 18.8332 6.57422 18.0181"
                                      stroke="#40454A" stroke-width="1.5" stroke-miterlimit="10" />
                                <path class="dot"
                                      d="M15.0254 7.03778C16.4061 7.03778 17.5254 5.92184 17.5254 4.54526C17.5254 3.16868 16.4061 2.05273 15.0254 2.05273C13.6447 2.05273 12.5254 3.16868 12.5254 4.54526C12.5254 5.92184 13.6447 7.03778 15.0254 7.03778Z"
                                      stroke="#40454A" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </span>
                        <span class="sidebar-link-txt @(IsMinMode?"":"show")">Notifications</span>
                        <div class="sidebar-link-tooltip" style="@(IsMinMode?"display:flex;":"display:none;")">
                            <span>Notifications</span>
                        </div>
                    </a>
                </li>
                <li>
                    <a href="createcase" class="@(IsMinMode?"":"full")">
                        <span class="sidebar-link-icon">
                            <svg data-type="new-post" width="22" height="22" viewBox="0 0 22 22" fill="none"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path d="M5.30541 2.47744C6.99101 1.35115 8.97275 0.75 11 0.75C13.7185 0.75 16.3256 1.82991 18.2478 3.75215C20.1701 5.6744 21.25 8.28153 21.25 11C21.25 13.0273 20.6488 15.009 19.5226 16.6946C18.3963 18.3802 16.7955 19.694 14.9225 20.4698C13.0496 21.2456 10.9886 21.4485 9.00033 21.053C7.01202 20.6575 5.18565 19.6813 3.75216 18.2478C2.31867 16.8144 1.34245 14.988 0.946956 12.9997C0.551457 11.0114 0.754441 8.95044 1.53024 7.07749C2.30604 5.20455 3.61981 3.60372 5.30541 2.47744ZM5.34509 19.4632C7.01895 20.5816 8.98687 21.1786 11 21.1786C13.6995 21.1786 16.2885 20.1062 18.1973 18.1973C20.1062 16.2885 21.1786 13.6995 21.1786 11C21.1786 8.98687 20.5816 7.01895 19.4632 5.34509C18.3447 3.67123 16.7551 2.36662 14.8952 1.59623C13.0353 0.825834 10.9887 0.624264 9.01426 1.01701C7.03981 1.40975 5.22617 2.37916 3.80267 3.80266C2.37917 5.22616 1.40975 7.03981 1.01701 9.01426C0.624269 10.9887 0.825839 13.0353 1.59623 14.8952C2.36662 16.7551 3.67124 18.3447 5.34509 19.4632Z"
                                      fill="#40454A" stroke="#40454A" stroke-width="1.5"></path>
                                <path d="M11.7859 10.2144V4.71443C11.7859 4.50604 11.7031 4.30619 11.5557 4.15884C11.4084 4.01149 11.2085 3.92871 11.0001 3.92871C10.7918 3.92871 10.5919 4.01149 10.4446 4.15884C10.2972 4.30619 10.2144 4.50604 10.2144 4.71443V10.2144H4.71443C4.50604 10.2144 4.30619 10.2972 4.15884 10.4446C4.01149 10.5919 3.92871 10.7918 3.92871 11.0001C3.92871 11.2085 4.01149 11.4084 4.15884 11.5557C4.30619 11.7031 4.50604 11.7859 4.71443 11.7859H10.2144V17.2859C10.2144 17.4942 10.2972 17.6941 10.4446 17.8414C10.5919 17.9888 10.7918 18.0716 11.0001 18.0716C11.2085 18.0716 11.4084 17.9888 11.5557 17.8414C11.7031 17.6941 11.7859 17.4942 11.7859 17.2859V11.7859H17.2859C17.4942 11.7859 17.6941 11.7031 17.8414 11.5557C17.9888 11.4084 18.0716 11.2085 18.0716 11.0001C18.0716 10.7918 17.9888 10.5919 17.8414 10.4446C17.6941 10.2972 17.4942 10.2144 17.2859 10.2144H11.7859Z"
                                      fill="#40454A" stroke="#40454A" stroke-width="0.5"></path>
                            </svg>
                        </span>
                        <span class="sidebar-link-txt @(IsMinMode?"":"show")">New Posts</span>
                        <div class="sidebar-link-tooltip" style="@(IsMinMode?"display:flex;":"display:none;")">
                            <span>New Posts</span>
                        </div>
                    </a>
                </li>
                <li>
                    <a href="Settings" class="@(IsMinMode?"":"full")">
                        <span class="sidebar-link-icon">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M7.74671 2.72652C8.39366 0.424492 11.6063 0.424493 12.2533 2.72652C12.6003 3.9614 13.8497 4.69387 15.0763 4.38164C17.363 3.79957 18.9694 6.62492 17.3296 8.34489C16.45 9.26753 16.45 10.7325 17.3296 11.6551C18.9694 13.3751 17.363 16.2004 15.0763 15.6184C13.8497 15.3061 12.6003 16.0386 12.2533 17.2735C11.6063 19.5755 8.39366 19.5755 7.74671 17.2735C7.39966 16.0386 6.15033 15.3061 4.92368 15.6184C2.63698 16.2004 1.03064 13.3751 2.67039 11.6551C3.54999 10.7325 3.54999 9.26753 2.67039 8.34489C1.03064 6.62492 2.63698 3.79957 4.92368 4.38164C6.15033 4.69387 7.39966 3.9614 7.74671 2.72652Z"
                                      stroke="#40454A" stroke-width="1.5" />
                                <path d="M13 10C13 11.6569 11.6569 13 10 13C8.34315 13 7 11.6569 7 10C7 8.34315 8.34315 7 10 7C11.6569 7 13 8.34315 13 10Z"
                                      stroke="#40454A" stroke-width="1.5" />
                            </svg>
                        </span>
                        <span class="sidebar-link-txt @(IsMinMode?"":"show")">Settings</span>
                        <div class="sidebar-link-tooltip" style="@(IsMinMode?"display:flex;":"display:none;")">
                            <span>Settings</span>
                        </div>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <!-- Sidebar Expand & Collapse -->
    <div class="sidebar-bot @(IsMinMode?"":"expand")" @onclick="ToggleMode">
        <button id="sidebar-btn" class="sidebar-btn">
            <div class="sidebar-link-tooltip expand @(IsMinMode?"":"sidebar-toggle")">
                <span>Expand Sidebar</span>
            </div>
            @if (IsMinMode)
            {
                <img src="./img/icons/collapse.svg" alt="">
            }
            else
            {
                <img src="./img/icons/expand.svg" alt="">
            }
        </button>
    </div>

</aside>
<!-- Sidebar End -->
@code {

    private bool IsMinMode { get; set; } = false;
    private string SidebarCssClass { get; set; } = "ft-sidebar";
    private string SidebarCustomCssClass { get; set; } = "";
    private string FullUserName { get; set; }
    private string UserSpeciality { get; set; }
    private string ProfileUrl { get; set; } = "/img/hippra/blank-profile.png";
    private string UserProfileId { get; set; }
    protected override async Task OnInitializedAsync()
    {

        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity is not null && user.Identity.IsAuthenticated)
        {
            ProfileUrl = user.FindFirst(c => c.Type == "ProfilePicture")?.Value;
            UserProfileId = user.FindFirst(c => c.Type == ClaimTypes.NameIdentifier)?.Value;
            FullUserName = user.FindFirst(c => c.Type == "FullName")?.Value;
            UserSpeciality = user.FindFirst(c => c.Type == "MedicalSpecialty")?.Value;
            var username = user.FindFirst(c => c.Type == "UserName")?.Value;
        }
        else
        {
            //  authMessage = "The user is NOT authenticated.";
        }

        IsMinMode = false;
    }



    private async Task ToggleMode()
    {
        IsMinMode = !IsMinMode;
        // if (!IsMinMode)
        // {
        //     SidebarCssClass = "ft-sidebar";
        // }
        // else
        // {
        //     SidebarCssClass = "ft-sidebar-min";
        // }
        await ToggleModeChanged.InvokeAsync();

    }

    [Parameter]
    public EventCallback ToggleModeChanged { get; set; }

    // private async Task wBack()
    // {
    //     //await JSRuntime.InvokeAsync<string>("fireAlert","");
    //     await JSRuntime.InvokeVoidAsync("toggleSidebar");
    // }
}
