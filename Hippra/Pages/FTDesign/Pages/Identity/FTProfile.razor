@page "/FTProfile/{userId:int}"

@using System.ComponentModel.DataAnnotations
@using Microsoft.AspNetCore.Authentication
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Identity
@using System.Text
@using System.Text.Encodings.Web
@using Hippra.Models.FTDesign
@using Hippra.Services
@using Hippra.Models.SQL
@using Hippra.Models.Enums 
@using System.Security.Claims
@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor httpContextAccessor
@inject IJSRuntime JSRuntime
@inject SignInManager<AppUser> SignInManager
@inject UserManager<AppUser> UserManager
@inject Microsoft.AspNetCore.Components.NavigationManager  NavigationManager
@inject ProfileService pService;
@using Microsoft.AspNetCore.Mvc.Rendering;
@using Hippra.Extensions


<AuthorizeView>
    <Authorized Context="ViewProfileContext">
        @if (userId == -1)
        {
            <FTSubHeaderBar Title="Profile" HasSeparator="false">
                <div class="flex-grow-1"></div>
                <a href="FTEditProfile">Edit</a>
            </FTSubHeaderBar>
        }
        else
        {
            <FTSubHeaderBar Title="Profile" HasSeparator="false">
            </FTSubHeaderBar>

        }

    <div class="ft-main-px">

        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="offset-md-2 col-md-8 offset-md-2 text-center">
                        <br />
                        <h4 class="display-4 text-center">Profile</h4>
                        <br />
                        <div class="row py-2">
                            <div class="col text-center">
                                <br />
                                <img src="/img/idea/i8s.jpg" class="ft-login-main-width" />
                            </div>
                            <div class="col text-left">
                                <p class="lead">Account</p>
                                <p class=" text-dark">@profile.FirstName @profile.LastName</p>
                                <address>
                                    @profile.Address<br />
                                    @profile.City, @profile.State @profile.Zipcode <br /><br />

                                    <a href="tel:+@profile.PhoneNumber">@profile.PhoneNumber</a> <br />
                                </address>
                                <br />
                                <p class="lead"> Professional Profile</p>
                                <p class=" text-dark">National Provider Identifier Number: @profile.NPIN</p>
                                <p class=" text-dark">Medical Specialty: @medicalSpecialty</p>
                                <p class=" text-dark">American Board Certified: @boardCertified</p>
                                <p class=" text-dark">Residency Hospital: @profile.ResidencyHospital</p>
                                <p class=" text-dark">Medical School Attended: @profile.MedicalSchoolAttended</p>
                                <p class=" text-dark">Education/Degree: @profile.EducationDegree</p>
                                <br />
                            </div>
                        </div>
                        <br />
                    </div>
                </div>
            </div>
        </div>
    </div>


    </Authorized>
    <NotAuthorized>
        <div class="ft-main-px">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="offset-md-3 col-md-6 offset-md-3 text-center">
                            <br /><br />
                            <div class="mb-3 ms-fontWeight-semibold ms-fontSize-24 ">Need To Sign In!</div>
                            <br /><br />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </NotAuthorized>
</AuthorizeView>


@code {
    [Parameter]
    public int userId { get; set; } = -1; // public ID

    [CascadingParameter]
    private Task<AuthenticationState> authenticationStateTask { get; set; }
    private AuthenticationState authState { get; set; }
    private ClaimsPrincipal user { get; set; }
    private FTRegisterModel profile { get; set; } = new FTRegisterModel();

    private string medicalSpecialty = "";
    private string boardCertified = "No";

    protected override async Task OnInitializedAsync()
    {
        authState = await authenticationStateTask;
        user = authState.User;
        AppUser usr = null;
        if (user.Identity.IsAuthenticated)
        {
            if (userId == -1)
            {
                usr = await UserManager.GetUserAsync(user);
            }
            else
            {
                usr = await Hippra.Extensions.UserManagerExtensions.FindByPublicIDNoTrackAsync(UserManager, userId);
            }
            if (usr == null)
            {
                NavigationManager.NavigateTo("/");
            }
        }

        profile = new FTRegisterModel()
        {
            UserName = usr.UserName,
            Email = usr.Email,

            FirstName = usr.FirstName,
            LastName = usr.LastName,
            NPIN = usr.NPIN,
            MedicalSpecialty = usr.MedicalSpecialty,
            AmericanBoardCertified = usr.AmericanBoardCertified,
            ResidencyHospital = usr.ResidencyHospital,
            MedicalSchoolAttended = usr.MedicalSchoolAttended,
            EducationDegree = usr.EducationDegree,
            Address = usr.Address,
            Zipcode = usr.Zipcode,
            State = usr.State,
            City = usr.City,
            PhoneNumber = usr.PhoneNumber
        };
        if (usr.AmericanBoardCertified)
        {
            boardCertified = "Yes";
        }
        switch ((MedicalSpecialtyType)usr.MedicalSpecialty)
        {
            case MedicalSpecialtyType.Anesthesiology:
                medicalSpecialty = "Anesthesiology";
                break;
            case MedicalSpecialtyType.AnatomicPathologyAndClinicalPathology:
                medicalSpecialty = "Anatomic Pathology And Clinical Pathology";
                break;
            case MedicalSpecialtyType.ColonAndRectalSurgery:
                medicalSpecialty = "Colon And Rectal Surgery";
                break;
            case MedicalSpecialtyType.Dermatology:
                medicalSpecialty = "Dermatology";
                break;
            case MedicalSpecialtyType.EmergencyMedicine:
                medicalSpecialty = "Emergency Medicine";
                break;
            case MedicalSpecialtyType.FamilyMedicine:
                medicalSpecialty = "Family Medicine";
                break;
            case MedicalSpecialtyType.HospiceAndPalliativeMedicine:
                medicalSpecialty = "Hospice And Palliative Medicine";
                break;
            case MedicalSpecialtyType.InternalMedicine:
                medicalSpecialty = "Internal Medicine";
                break;
            case MedicalSpecialtyType.MedicalGenetics:
                medicalSpecialty = "Medical Genetics";
                break;
            case MedicalSpecialtyType.MedicalNuclearPhysics:
                medicalSpecialty = "Medical Nuclear Physics";
                break;

            case MedicalSpecialtyType.Neurology:
                medicalSpecialty = "Neurology";
                break;
            case MedicalSpecialtyType.Neurosurgery:
                medicalSpecialty = "Neurosurgery";
                break;
            case MedicalSpecialtyType.NuclearMedicine:
                medicalSpecialty = "NuclearMedicine";
                break;
            case MedicalSpecialtyType.ObstetricsAndGynecology:
                medicalSpecialty = "Obstetrics And Gynecology";
                break;
            case MedicalSpecialtyType.Ophthalmology:
                medicalSpecialty = "Ophthalmology";
                break;
            case MedicalSpecialtyType.OrthopedicSurgery:
                medicalSpecialty = "Orthopedic Surgery";
                break;
            case MedicalSpecialtyType.Otolaryngology:
                medicalSpecialty = "Otolaryngology";
                break;
            case MedicalSpecialtyType.Pediatrics:
                medicalSpecialty = "Pediatrics";
                break;
            case MedicalSpecialtyType.PhysicalMedicineAndRehibilitation:
                medicalSpecialty = "Physical Medicine And Rehibilitation";
                break;
            case MedicalSpecialtyType.PlasticSurgery:
                medicalSpecialty = "PlasticSurgery";
                break;
            case MedicalSpecialtyType.Psychiatry:
                medicalSpecialty = "Psychiatry";
                break;
            case MedicalSpecialtyType.PublicHealthAndGeneralPreventive:
                medicalSpecialty = "Public Health And General Preventive";
                break;
            case MedicalSpecialtyType.Radiology:
                medicalSpecialty = "Radiology";
                break;
            case MedicalSpecialtyType.Surgery:
                medicalSpecialty = "Surgery";
                break;
            case MedicalSpecialtyType.ThoracicSurgery:
                medicalSpecialty = "Thoracic Surgery";
                break;
            case MedicalSpecialtyType.Urology:
                medicalSpecialty = "Urology";
                break;
            case MedicalSpecialtyType.VascularSurgery:
                medicalSpecialty = "Vascular Surgery";
                break;
            default:
                break;
        }
    }

}
